<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AudioMax</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/index.js" defer></script>
    <script src="/js/audio.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
      integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/uicons-bold-straight/css/uicons-bold-straight.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/uicons-bold-rounded/css/uicons-bold-rounded.css"
    />
  </head>
  <body>
    <header>
      <div class="logo">
        <h1>AudioMax</h1>
        <p>Media Player for all...</p>
      </div>
    </header>
    <main>
      <section id="file-control-panel">
        <button class="new">New +</button>
        <div class="files">
          <div class="playlist-container">
            <!-- <div class="playlist" data-name="Playlist_C">
              <header data-name="Playlist_C" class="accordion">
                <i class="fa-solid fa-angle-right"></i>
                <i class="fa-solid fa-folder"></i>
                <p class="playlist-name">Playlist_C</p>
              </header>
              <div class="list">
                <div class="file" data-name="name">
                  <p><i class="fi fi-sr-music-file"></i>name</p>
                </div>
                <div class="file" data-name="name">
                  <p><i class="fi fi-sr-music-file"></i>name</p>
                </div>
              </div>
            </div>
            <div class="playlist" data-name="Playlist_D">
              <header data-name="Playlist_D" class="accordion">
                <i class="fa-solid fa-angle-right"></i>
                <i class="fa-solid fa-folder"></i>
                <p class="playlist-name">Playlist_D</p>
                <p></p>
              </header>

              <div class="list">
                <div class="file" data-name="name">
                  <p><i class="fi fi-sr-music-file"></i>name</p>
                </div>
                <div class="file" data-name="name">
                  <p><i class="fi fi-sr-music-file"></i>name</p>
                </div>
              </div>
            </div> -->
          </div>
        </div>
      </section>
      <section id="media-player">
        <audio
          src="/assets/audios/Roddy_Ricch_-_The_Box.mp3"
          controls
          autoplay
          loop
        ></audio>
      </section>
    </main>

    <!-- 
      display when the new button is clicked...
     -->
    <div class="modal create-new-modal">
      <div class="new-modal">
        <span class="close">X</span>
        <p onClick="showAddSongForm()">Media file</p>
        <p onClick="showPlaylistForm()">Playlist</p>
      </div>
    </div>

    <!-- 
      Playlist modal
     -->

    <div class="modal playlist-modal">
      <div class="new-modal">
        <span class="close">X</span>
        <p id="play"><i class="fa-solid fa-play"></i>Play</p>
        <p id="new-song">
          <i class="fa-solid fa-cloud-arrow-up"></i>Add new song
        </p>
        <p id="rename"><i class="fa-solid fa-pen"></i>Rename</p>
        <p id="delete"><i class="fa-solid fa-trash"></i>Delete</p>
      </div>
    </div>

    <!-- 
      Create playlist form
     -->
    <div class="modal playlist-form">
      <form action="/playlist" method="post">
        <h2>Create Playlist</h2>
        <div class="form_group">
          <label for="playlist_title">Title</label>
          <input type="text" name="playlist_title" id="playlist_title" />
        </div>
        <button type="submit">
          <div class="spinner-3"></div>
          Create
        </button>
      </form>
    </div>

    <!-- 
      Rename playlist form
     -->
    <div class="modal rename-playlist">
      <form action="/playlist">
        <h2>Rename</h2>
        <div class="form_group">
          <label for="playlist_title">to:</label>
          <input type="text" name="playlist_title" id="playlist_title" />
        </div>
        <button type="submit">
          <div class="spinner-3"></div>
          Rename
        </button>
      </form>
    </div>

    <!-- Add new song -->
    <div class="modal add-song">
      <form action="/media" method="post" id="add-song-form">
        <h2>Add new song</h2>
        <div class="form_group">
          <label for="playlist_title">Select Playlist</label>
          <div class="custom-select">
            <select name="playlist_title" id="playlist_title" required>
              <option value="null">Select Playlist</option>
            </select>
          </div>
        </div>
        <div class="form_group">
          <label for="audio">Choose audio</label>
          <div class="audio-upload-container">
            <i class="fa-solid fa-cloud-arrow-up" onClick="clickFile(this)"></i>
            <input type="file" name="audio" id="audio" />
          </div>
        </div>
        <div class="form_group">
          <label for="thumbnail">Choose thumbnail(Max 2MB)</label>
          <div class="thumbnail-upload-container">
            <i class="fa-solid fa-cloud-arrow-up" onClick="clickFile(this)"></i>
            <input type="file" name="thumbnail" id="thumbnail" />
          </div>
        </div>
        <button type="submit" id="submit-add-song-btn">
          <div class="spinner-3"></div>
          Add song
        </button>
      </form>
    </div>

    <!-- Error  -->
    <div class="fill_all">
      <img src="/assets/imgs/error.png" />
      <p>Please fill all field</p>
    </div>

    <!-- Error  -->
    <div class="fill_all loading">
      <img src="/assets/imgs/upload.png" />
      <p>Please fill all field</p>
    </div>

    <!-- Success  -->
    <div class="fill_all success">
      <img src="/assets/imgs/success.png" />
      <p>Playlist Deleted Successfully</p>
    </div>

    <!-- Confirm Modal -->
    <div class="modal confirmation">
      <div class="confirm-modal">
        <h2>Are you sure you want to delete?</h2>
        <div class="confirm-actions">
          <button id="confirm-delete">
            <div class="spinner-3"></div>
            Confirm
          </button>
          <button id="cancel">Cancel</button>
        </div>
      </div>
    </div>

    <!-- 
      get playlists from the server and loads them into the dom
     -->
    <script>
      const playlistContainer = document.querySelector(".playlist-container");
      window.playlists = [];

      async function getPlaylists() {
        let res = await fetch("/playlist");
        let data = await res.json();
        window.playlists = data.data;
        populatePlaylist();
        loadSelectOptions(window.playlists, false);
      }
      getPlaylists();

      function populatePlaylist() {
        let data = ``;
        playlistContainer.innerHTML = "";
        window.playlists.forEach((playlist) => {
          let newPlaylist = createNewPlayistElement(playlist.name);
          let newPlaylistHeader = createNewHeaderElement(playlist.name);
          let newPlaylistList = createNewPlayistListElement();
          newPlaylist.appendChild(newPlaylistHeader);
          playlistContainer.appendChild(newPlaylist);

          playlist.audios.forEach((audio) => {
            let newFile = createNewFile(audio.path);
            let newFileText = createNewFileText(
              audio.name.substr(0, 20),
              audio.path
            );
            newFile.appendChild(newFileText);
            newPlaylistList.appendChild(newFile);
          });
          newPlaylist.appendChild(newPlaylistList);
        });
      }

      const createNewPlayistElement = (playlistName) => {
        let newPlaylist = document.createElement("div");
        newPlaylist.className = "playlist";
        newPlaylist.dataset.name = playlistName;
        return newPlaylist;
      };

      const createNewPlayistListElement = () => {
        let newList = document.createElement("div");
        newList.className = "list";
        return newList;
      };
      const createNewFile = (path) => {
        let newFile = document.createElement("div");
        newFile.className = "file";
        newFile.dataset.name = `/assets/audios/${path}`;
        return newFile;
      };
      const createNewFileText = (name, path) => {
        let newFileText = document.createElement("p");
        newFileText.dataset.name = `/assets/audios/${path}`;
        newFileText.innerHTML = `<i class="fi fi-sr-music-file"></i>${name}`;
        return newFileText;
      };

      const createNewHeaderElement = (playlistName) => {
        let newHeader = document.createElement("header");
        newHeader.className = "accordion";
        newHeader.dataset.name = playlistName;
        newHeader.innerHTML = `
            <i class="fa-solid fa-angle-right"></i>
            <i class="fa-solid fa-folder"></i>
            <p class="playlist-name">${playlistName}</p>
          `;
        return newHeader;
      };
    </script>
    <script>
      function customSelect() {
        let selItem = document.querySelector(".select-items");
        let selSelected = document.querySelector(".select-selected");
        if (selItem) {
          selItem.remove();
        }

        if (selSelected) {
          selSelected.remove();
        }
        var x, i, j, l, ll, selElmnt, a, b, c;
        /*look for any elements with the class "custom-select":*/
        x = document.getElementsByClassName("custom-select");
        l = x.length;
        for (i = 0; i < l; i++) {
          selElmnt = x[i].getElementsByTagName("select")[0];
          ll = selElmnt.length;
          /*for each element, create a new DIV that will act as the selected item:*/
          a = document.createElement("DIV");
          a.setAttribute("class", "select-selected");
          a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
          x[i].appendChild(a);
          /*for each element, create a new DIV that will contain the option list:*/
          b = document.createElement("DIV");
          b.setAttribute("class", "select-items select-hide");
          for (j = 0; j < ll; j++) {
            /*for each option in the original select element,
    create a new DIV that will act as an option item:*/
            c = document.createElement("DIV");
            c.innerHTML = selElmnt.options[j].innerHTML;
            c.addEventListener("click", function (e) {
              /*when an item is clicked, update the original select box,
        and the selected item:*/
              var y, i, k, s, h, sl, yl;
              s = this.parentNode.parentNode.getElementsByTagName("select")[0];
              sl = s.length;
              h = this.parentNode.previousSibling;
              for (i = 0; i < sl; i++) {
                if (s.options[i].innerHTML == this.innerHTML) {
                  s.selectedIndex = i;
                  h.innerHTML = this.innerHTML;
                  y =
                    this.parentNode.getElementsByClassName("same-as-selected");
                  yl = y.length;
                  for (k = 0; k < yl; k++) {
                    y[k].removeAttribute("class");
                  }
                  this.setAttribute("class", "same-as-selected");
                  break;
                }
              }
              h.click();
            });
            b.appendChild(c);
          }
          x[i].appendChild(b);
          a.addEventListener("click", function (e) {
            /*when the select box is clicked, close any other select boxes,
      and open/close the current select box:*/
            e.stopPropagation();
            closeAllSelect(this);
            this.nextSibling.classList.toggle("select-hide");
            this.classList.toggle("select-arrow-active");
          });
        }
        function closeAllSelect(elmnt) {
          /*a function that will close all select boxes in the document,
  except the current select box:*/
          var x,
            y,
            i,
            xl,
            yl,
            arrNo = [];
          x = document.getElementsByClassName("select-items");
          y = document.getElementsByClassName("select-selected");
          xl = x.length;
          yl = y.length;
          for (i = 0; i < yl; i++) {
            if (elmnt == y[i]) {
              arrNo.push(i);
            } else {
              y[i].classList.remove("select-arrow-active");
            }
          }
          for (i = 0; i < xl; i++) {
            if (arrNo.indexOf(i)) {
              x[i].classList.add("select-hide");
            }
          }
        }
        /*if the user clicks anywhere outside the select box,
then close all select boxes:*/
        document.addEventListener("click", closeAllSelect);
      }
    </script>
  </body>
</html>
